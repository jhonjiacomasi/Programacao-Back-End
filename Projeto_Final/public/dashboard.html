<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Loja Primo - Dashboard</title>
    <link rel="stylesheet" href="/css/styles.css" />
</head>
<body>
    <div class="dashboard-container">
        <div class="dashboard-header">
            <div>
                <h1 class="welcome-text">Bem-vindo, <span id="username">...</span>!</h1>
                <p style="color: #666; margin-top: 0.5rem;">Painel de Controle - Loja Primo</p>
            </div>
            <button id="logoutBtn" class="logout-btn">Sair</button>
        </div>
        
        <div class="dashboard-content">
            <div class="card">
                <h3>üõçÔ∏è E-commerce</h3>
                <p>Acesse a √°rea de vendas e produtos da Loja Primo. Gerencie seu cat√°logo e visualize as √∫ltimas novidades.</p>
                <a href="/ecommerce" class="ecommerce-link">Acessar E-commerce</a>
            </div>
            
            <div class="card">
                <h3>üìä Estat√≠sticas</h3>
                <p>Visualize relat√≥rios de vendas, produtos mais vendidos e performance geral da loja.</p>
                <div style="margin-top: 1rem; padding: 0.75rem; background: rgba(102, 126, 234, 0.1); border-radius: 8px;">
                    <strong>Status:</strong> <span id="systemStatus">Carregando...</span> ‚úÖ
                </div>
            </div>
            
            <div class="card">
                <h3>‚öôÔ∏è Configura√ß√µes</h3>
                <p>Gerencie as configura√ß√µes da sua conta e prefer√™ncias do sistema.</p>
                <div style="margin-top: 1rem; color: #666; font-size: 0.9rem;">
                    <strong>Usu√°rio:</strong> <span id="userInfo">...</span><br>
                    <strong>√öltimo acesso:</strong> <span id="lastAccess">Agora</span>
                </div>
            </div>
            
            <div class="card">
                <h3>üîí Seguran√ßa</h3>
                <p>Esta √© uma √°rea protegida que s√≥ pode ser acessada ap√≥s login com credenciais v√°lidas.</p>
                <div style="margin-top: 1rem; padding: 0.75rem; background: rgba(56, 161, 105, 0.1); border-radius: 8px; color: #38a169;">
                    <strong>‚úì Sess√£o ativa e segura</strong>
                </div>
            </div>
        </div>
        
        <div style="margin-top: 2rem; text-align: center; color: #666; font-size: 0.9rem;">
            <p>¬© 2024 Loja Primo - Sistema de Gerenciamento</p>
        </div>
    </div>

    <script>
        // Verificar autentica√ß√£o e carregar dados
        async function checkAuthAndLoadData() {
            try {
                const authResponse = await fetch('/api/check-auth');
                const authData = await authResponse.json();
                
                if (!authData.authenticated) {
                    window.location.href = '/login';
                    return;
                }
                
                // Carregar dados do dashboard
                const dashboardResponse = await fetch('/api/protected/dashboard');
                const dashboardData = await dashboardResponse.json();
                
                if (dashboardData.success) {
                    document.getElementById('username').textContent = dashboardData.data.username;
                    document.getElementById('userInfo').textContent = dashboardData.data.username;
                    document.getElementById('systemStatus').textContent = dashboardData.data.stats.systemStatus;
                    
                    const lastAccess = new Date(dashboardData.data.lastAccess).toLocaleString('pt-BR');
                    document.getElementById('lastAccess').textContent = lastAccess;
                }
            } catch (error) {
                console.error('Erro ao carregar dados:', error);
                window.location.href = '/login';
            }
        }
        
        // Fun√ß√£o de logout
        document.getElementById('logoutBtn').addEventListener('click', async function() {
            try {
                const response = await fetch('/api/auth/logout', {
                    method: 'POST'
                });
                
                const data = await response.json();
                
                if (data.success) {
                    window.location.href = '/login';
                }
            } catch (error) {
                console.error('Erro no logout:', error);
                window.location.href = '/login';
            }
        });
        
        // Carregar dados quando a p√°gina carregar
        document.addEventListener('DOMContentLoaded', checkAuthAndLoadData);
    </script>
</body>
</html>

